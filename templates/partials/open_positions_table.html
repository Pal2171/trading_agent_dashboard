{% if positions %}
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>Simbolo</th>
                <th>Direzione</th>
                <th>Size</th>
                <th>Entry Price</th>
                <th>Mark Price</th>
                <th>Leva</th>
                <th>PnL (USD)</th>
                <th>Snapshot</th>
            </tr>
        </thead>
        <tbody>
            {% for pos in positions %}
            <tr>
                <td><strong>{{ pos.symbol }}</strong></td>
                <td>
                    {% if pos.side %}
                    <span
                        class="badge {% if pos.side|lower == 'long' %}badge-long{% elif pos.side|lower == 'short' %}badge-short{% endif %}">
                        {{ pos.side|upper }}
                    </span>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>{{ '%.4f' | format(pos.size) }}</td>
                <td>{{ '%.4f' | format(pos.entry_price) if pos.entry_price else '-' }}</td>
                <td>{{ '%.4f' | format(pos.mark_price) if pos.mark_price else '-' }}</td>
                <td>{{ pos.leverage or '1x' }}</td>
                <td>
                    {% if pos.pnl_usd is not none %}
                    <span class="{% if pos.pnl_usd >= 0 %}text-success{% else %}text-danger{% endif %}">
                        {{ '%.2f' | format(pos.pnl_usd) }} $
                    </span>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td class="text-muted">{{ pos.snapshot_created_at.strftime('%d/%m %H:%M') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div style="padding: 2rem; text-align: center; color: var(--text-muted);">
    <p>Nessuna posizione aperta al momento.</p>
</div>
{% endif %}